# Morav 개발 계획서 (헌법)

## 개요

이 문서는 Morav 프로젝트의 개발 방법론, TDD 사이클, Tidy First 원칙, 커밋 규율을 정의합니다.
모든 개발 활동은 이 문서를 준수해야 합니다. 다른 문서와 충돌 시 이 계획서가 우선합니다.

---

## 1. 개발 방법론

### TDD (테스트 주도 개발) - Kent Beck 스타일

우리는 **Red → Green → Refactor** 사이클을 엄격히 따릅니다:

1. **Red**: 가장 작은 실패하는 테스트를 먼저 작성
2. **Green**: 테스트를 통과하기 위한 최소한의 코드만 작성
3. **Refactor**: 모든 테스트가 통과한 후에만 구조 개선

### Tidy First 원칙

모든 변경 사항은 두 가지 유형 중 하나로 분류됩니다:

| 유형 | 설명 | 예시 |
|------|------|------|
| **STRUCTURAL** | 구조만 변경, 동작은 변경 없음 | 이름 변경, 메서드 추출, 코드 이동 |
| **BEHAVIORAL** | 실제 기능을 추가하거나 수정 | 새 기능, 버그 수정 |

**핵심 규칙:**
- 구조적 변경과 동작 변경을 같은 커밋에 혼합하지 않음
- 둘 다 필요한 경우, 구조적 변경을 먼저 수행
- 구조적 변경 전후에 테스트를 실행하여 동작이 변경되지 않았음을 확인

---

## 2. 개발 단계

### Phase 1: 기반 구축
- 프로젝트 초기화 (Next.js 14+, TypeScript, pnpm)
- Supabase 설정
- 기본 폴더 구조
- ESLint + Prettier 설정
- 테스트 프레임워크 설정 (Jest, Playwright)

### Phase 2: 인증 및 사용자 관리
- Supabase Auth를 이용한 이메일 회원가입/로그인
- Google OAuth 연동
- 사용자 프로필 관리
- 비밀번호 재설정 플로우

### Phase 3: 온보딩 플로우
- 블로그 플랫폼 OAuth 연동 (티스토리, 구글 블로거, 워드프레스)
- 암호화를 적용한 AI API 키 등록
- 카테고리 선택
- 발행 스케줄 설정

### Phase 4: 핵심 기능
- 키워드 수집 시스템 (Cron jobs)
- AI 콘텐츠 생성 연동
- 멀티 플랫폼 자동 발행
- 실시간 상태를 보여주는 대시보드

### Phase 5: 구독 및 결제
- 토스페이먼츠 연동
- 구독 플랜 관리
- 사용량 추적 및 제한

### Phase 6: 마무리 및 출시
- 에러 처리 및 재시도 로직
- 알림 시스템
- 성능 최적화
- 보안 감사

---

## 3. 커밋 규율

### 커밋 요구 사항

다음 조건이 **모두** 충족될 때만 커밋합니다:

- [ ] 모든 테스트 통과
- [ ] 컴파일러/린터 경고 없음
- [ ] 하나의 논리적 작업 단위만 포함
- [ ] 커밋 메시지에 변경 유형 명시 (STRUCTURAL 또는 BEHAVIORAL)

### 커밋 메시지 형식

```
[TYPE] 간단한 설명

- 상세 변경 사항 1
- 상세 변경 사항 2

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```

**TYPE 값:**
- `[STRUCTURAL]` - 구조만 변경
- `[BEHAVIORAL]` - 기능/동작 변경
- `[FIX]` - 버그 수정
- `[TEST]` - 테스트 추가
- `[DOCS]` - 문서 업데이트

### 커밋 빈도

- 큰 커밋보다 작고 빈번한 커밋 선호
- 각 커밋은 단일 논리적 단위여야 함
- 테스트되지 않은 코드는 절대 커밋하지 않음

---

## 4. 코드 품질 표준

### 필수 준수 사항

- **중복을 철저히 제거**
- **이름과 구조를 통해 의도를 명확히 표현**
- **의존성을 명시적으로 만듦**
- **메서드는 단일 책임을 가지고 작아야 함**
- **상태와 부작용을 최소화**
- **현재 가능한 가장 단순한 해결책 사용**

### TypeScript 규칙

- Strict 모드 활성화
- `any` 타입 사용 금지
- 모든 props와 함수에 명시적 타입 정의
- 복잡한 함수에서 암시적 반환 금지

### 테스트 요구 사항

- 모든 유틸리티 함수에 단위 테스트
- API 라우트에 통합 테스트
- 중요한 사용자 플로우에 E2E 테스트
- 새 코드에 최소 80% 코드 커버리지

---

## 5. 태스크 실행 규칙

### 태스크 정의

각 태스크는 다음을 충족해야 합니다:
- 하나의 테스트로 검증 가능
- 단일 책임
- 가능한 가장 작은 실행 단위
- STRUCTURAL 또는 BEHAVIORAL로 명확히 표시

### 태스크 워크플로우

1. `tasks.md`에서 하나의 태스크 선택
2. 태스크를 IN_PROGRESS로 표시
3. 실패하는 테스트 작성 (Red)
4. 테스트를 통과하기 위한 최소 코드 작성 (Green)
5. 필요시 리팩토링
6. 모든 테스트 실행
7. 적절한 타입으로 커밋
8. 태스크를 DONE으로 표시
9. **멈추고 사용자의 "go" 명령을 기다림**

### 중요

- 한 번에 하나의 태스크만 완료
- 다음 태스크로 자동 진행하지 않음
- 항상 명시적인 사용자 승인을 기다림

---

## 6. 보안 요구 사항

### API 키 처리

- 모든 사용자 API 키는 저장 전 AES-256으로 암호화
- 복호화는 서버 사이드(API Routes)에서만
- 키를 프론트엔드에 절대 노출하지 않음

### 인증

- JWT 토큰: 15분 액세스, 7일 리프레시
- 레이트 리미팅: IP당 분당 60회 요청
- 모든 통신에 HTTPS 강제

### 데이터 보호

- 모든 테이블에 Row Level Security (RLS) 활성화
- auth.uid()로 사용자 데이터 격리
- GDPR 준수 데이터 삭제

---

## 7. 파일 구조

```
/app
  /dashboard        # 대시보드 페이지
  /onboarding       # 온보딩 플로우
  /auth             # 인증 페이지
  /api              # API 라우트
    /cron           # Cron Jobs
    /auth           # 인증 엔드포인트
    /generate       # AI 콘텐츠 생성
/components
  /ui               # shadcn/ui 컴포넌트
  /dashboard        # 대시보드 컴포넌트
  /common           # 공통 컴포넌트
/lib
  /supabase         # Supabase 클라이언트
  /ai               # AI 콘텐츠 생성
  /blog             # 블로그 플랫폼 연동
  /crypto           # 암호화/복호화
  /utils            # 유틸리티 함수
/types              # TypeScript 타입 정의
/public             # 정적 파일
/__tests__          # 테스트 파일
```

---

## 8. 기술 스택

| 카테고리 | 기술 | 버전 |
|----------|------|------|
| 런타임 | Node.js | 20.x LTS |
| 패키지 매니저 | pnpm | 최신 |
| 프레임워크 | Next.js | 14+ (App Router) |
| 언어 | TypeScript | 5.x |
| 데이터베이스 | Supabase (PostgreSQL) | 최신 |
| 스타일링 | Tailwind CSS | 3.x |
| UI 컴포넌트 | shadcn/ui | 최신 |
| 테스트 | Jest + Playwright | 최신 |
| 배포 | Vercel | - |

---

## 9. 완료 정의

태스크는 다음 조건을 충족할 때 DONE으로 간주됩니다:

1. 실패하는 테스트를 먼저 작성함
2. 통과하기 위한 최소 코드를 작성함
3. 모든 테스트 통과 (기존 테스트 포함)
4. 린터 경고 없음
5. 코드가 적절히 타입 지정됨
6. 올바른 타입으로 커밋됨
7. `tasks.md`에서 태스크 상태 업데이트됨

---

## 10. 참고 문서

- PRD: `docs/1_PRD.md`
- TRD: `docs/2_TRD.md`
- 사용자 플로우: `docs/3_UserFlow.md`
- 데이터베이스 설계: `docs/4_DatabaseDesign.md`
- 디자인 시스템: `docs/5_DesignSystem.md`
- 코딩 컨벤션: `docs/7_CodingConvention.md`
- 페이지 명세: `docs/Morav_*.md`
